rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ヘルパー関数：認証済みユーザーかどうか
    function isAuthenticated() {
      return request.auth != null;
    }

    // ルームのルール
    match /rooms/{roomId} {
      // 読み取り：認証済みユーザーなら誰でも読める（参加前の確認のため）
      allow read: if isAuthenticated();

      // 作成・更新・削除：Cloud Functionのみ（Admin SDKを使用）
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    // マッチング待機列のルール
    match /matching_queue/{userId} {
      // 自分のドキュメントのみ読み取り可能
      allow read: if isAuthenticated() && request.auth.uid == userId;
      
      // 書き込みはCloud Functions経由で行うため許可しない
      allow create, update, delete: if false;
    }
  }
}
